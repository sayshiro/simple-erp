{% extends "base.html" %}

{% block title %}Добавить металлопрокат{% endblock %}

{% block content %}
<div class="container">
    <h2>Добавить металлопрокат</h2>
    <form method="POST">
        {{ form.hidden_tag() }}
        
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="form-group">
                    <label>Тип металлопроката</label>
                    <select class="form-select" name="type_id" required>
                        <option value="">Выберите тип</option>
                        {% for type in metal_types %}
                        <option value="{{ type.id }}">{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="form-group">
                    <label>ГОСТ</label>
                    <select class="form-select" name="gost_id" required>
                        <option value="">Выберите ГОСТ</option>
                        {% for gost in gosts %}
                        <option value="{{ gost.id }}">{{ gost.number }} - {{ gost.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="form-group">
                    <label>Марка стали</label>
                    <select class="form-select" name="grade_id" required>
                        <option value="">Выберите марку</option>
                        {% for grade in grades %}
                        <option value="{{ grade.id }}">{{ grade.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- Размеры (появляются динамически в зависимости от типа) -->
        <div class="row mb-3" id="dimensions">
            <div class="col-md-3">
                <div class="form-group">
                    <label>Толщина (мм)</label>
                    <input type="number" class="form-control" name="thickness" step="0.1">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Ширина (мм)</label>
                    <input type="number" class="form-control" name="width" step="1">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Длина (мм)</label>
                    <input type="number" class="form-control" name="length" step="1">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>Диаметр (мм)</label>
                    <input type="number" class="form-control" name="diameter" step="0.1">
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-4">
                <div class="form-group">
                    <label>Вес единицы (кг)</label>
                    <input type="number" class="form-control" name="weight_per_unit" step="0.001" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Цена за единицу</label>
                    <input type="number" class="form-control" name="price_per_unit" step="0.01" required>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label>Количество на складе</label>
                    <input type="number" class="form-control" name="stock" step="0.001" required>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label>Склад</label>
                    <select class="form-select" name="warehouse_id" required>
                        <option value="">Выберите склад</option>
                        {% for warehouse in warehouses %}
                        <option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label>Поставщик</label>
                    <select class="form-select" name="supplier_id">
                        <option value="">Выберите поставщика</option>
                        {% for supplier in suppliers %}
                        <option value="{{ supplier.id }}">{{ supplier.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-primary">Добавить</button>
            <a href="{{ url_for('metal.index') }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>

<script>
// Здесь будет JavaScript для динамического изменения полей размеров
// в зависимости от выбранного типа металлопроката
document.querySelector('select[name="type_id"]').addEventListener('change', function() {
    const type = this.options[this.selectedIndex].text;
    const dimensions = document.getElementById('dimensions');
    
    // Показываем/скрываем поля в зависимости от типа
    if (type === 'Лист') {
        dimensions.querySelector('[name="thickness"]').parentElement.style.display = '';
        dimensions.querySelector('[name="width"]').parentElement.style.display = '';
        dimensions.querySelector('[name="length"]').parentElement.style.display = '';
        dimensions.querySelector('[name="diameter"]').parentElement.style.display = 'none';
    } else if (type === 'Труба круглая') {
        dimensions.querySelector('[name="thickness"]').parentElement.style.display = '';
        dimensions.querySelector('[name="width"]').parentElement.style.display = 'none';
        dimensions.querySelector('[name="length"]').parentElement.style.display = '';
        dimensions.querySelector('[name="diameter"]').parentElement.style.display = '';
    }
    // Добавьте другие типы по необходимости
});
</script>
{% endblock %}
